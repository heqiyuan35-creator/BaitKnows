<h1 _ngcontent-xtk-c119="" class="doc-title ng-star-inserted" title="瓦片图层"> 瓦片图层 </h1>

<div _ngcontent-xtk-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section8563111424615">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section8563111424615" tips="复制节点链接"></i></h2>          <p>从5.0.3(15)开始，支持瓦片图层功能；从6.0.0(20)开始，瓦片图层参数支持TileOverlayOptions类型。</p>     <p>新增瓦片图层（TileOverlay）, 该图层支持添加自有瓦片数据，包括在线下载和本地加载两种方式。该图层可随地图的平移、缩放、旋转等操作做相应的变换，它仅位于底图之上（即瓦片图层将会遮挡底图，不遮挡其他图层），瓦片图层的添加顺序不会影响其他图层的叠加关系。</p>     <p>通过瓦片图层可对基础底层地图添加额外的特性，如：某个商场的室内信息、某个景区的详情等等。适用于开发者拥有某一区域的地图，并希望使用此区域地图覆盖相应位置的华为地图。</p>     <p><span><img height="760.11096" originheight="2720" originwidth="1260" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114640.49829402374980378000991165643014:50001231000000:2800:3CC2806973204A1D1809591E19A463A6121A58A0C2501089D7A18C5458409FDB.jpg" title="点击放大" width="352.1175"></span></p>     <p></p>    </div>    <div class="tiledSection">     <h2 id="section7198121844411">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section7198121844411" tips="复制节点链接"></i></h2>          <p>瓦片图层功能主要由<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-common#section3168172982513" target="_blank">TileOverlayParams</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-common#section849136102717" target="_blank">TileOverlayOptions</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-mapcomponentcontroller#section169060253532" target="_blank">addTileOverlay</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-tileoverlay" target="_blank">TileOverlay</a>提供，更多接口及使用方法请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-tileoverlay" target="_blank">接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="70%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="30%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="70%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-common#section3168172982513" target="_blank">TileOverlayParams</a></p></td>         <td class="cellrowborder" valign="top" width="30%">          <p>瓦片图层参数。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="70%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-common#section849136102717" target="_blank">TileOverlayOptions</a></p></td>         <td class="cellrowborder" valign="top" width="30%">          <p>瓦片图层参数。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="70%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-mapcomponentcontroller#section169060253532" target="_blank">addTileOverlay</a>(params: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-common#section3168172982513" target="_blank">mapCommon.TileOverlayParams</a> | <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-common#section849136102717" target="_blank">mapCommon.TileOverlayOptions</a>): <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-tileoverlay" target="_blank">TileOverlay</a></p></td>         <td class="cellrowborder" valign="top" width="30%">          <p>为地图增加瓦片图层。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="70%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-tileoverlay" target="_blank">TileOverlay</a></p></td>         <td class="cellrowborder" valign="top" width="30%">          <p>瓦片图层，支持更新和查询相关属性。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section1564972414506">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1564972414506" tips="复制节点链接"></i></h2>          <p>瓦片图层的绘制方式提供两种方式：在线下载和本地加载。</p>    </div>    <div class="tiledSection">     <h3 id="section104834301919" class="firsth2">在线下载<i class="anchor-icon anchor-icon-link" anchorid="section104834301919" tips="复制节点链接"></i></h3>          <ol>      <li>导入相关模块。       <div _ngcontent-xtk-c106="" class="highlight-div"><div _ngcontent-xtk-c106="" class="highlight-div-header"><div _ngcontent-xtk-c106="" class="highlight-div-header-left"><div _ngcontent-xtk-c106="" class="handle-button expand-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xtk-c106="" class="highlight-div-header-right"><div _ngcontent-xtk-c106="" class="handle-button ai-button"></div><div _ngcontent-xtk-c106="" class="handle-button line-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xtk-c106="" class="handle-button theme-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xtk-c106="" class="handle-button copy-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xtk-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { map, mapCommon, <span class="hljs-title class_">MapComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MapKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AsyncCallback</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div></li>      <li><span style="color: rgb(38,38,38);">增加瓦片</span>图层，在线下载方式需要设置在线瓦片的URL地址。       <div _ngcontent-xtk-c106="" class="highlight-div"><div _ngcontent-xtk-c106="" class="highlight-div-header"><div _ngcontent-xtk-c106="" class="highlight-div-header-left"><div _ngcontent-xtk-c106="" class="handle-button expand-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xtk-c106="" class="highlight-div-header-right"><div _ngcontent-xtk-c106="" class="handle-button ai-button"></div><div _ngcontent-xtk-c106="" class="handle-button line-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xtk-c106="" class="handle-button theme-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xtk-c106="" class="handle-button copy-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xtk-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TileOverlayDemo</span> {</li><li>  <span class="hljs-keyword">private</span> mapOptions?: mapCommon.<span class="hljs-property">MapOptions</span>;</li><li>  <span class="hljs-keyword">private</span> mapController?: map.<span class="hljs-property">MapComponentController</span>;</li><li>  <span class="hljs-keyword">private</span> callback?: <span class="hljs-title class_">AsyncCallback</span>&lt;map.<span class="hljs-property">MapComponentController</span>&gt;;</li><li>  <span class="hljs-keyword">private</span> tileOverlay?: map.<span class="hljs-property">TileOverlay</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapOptions</span> = {</li><li>      <span class="hljs-attr">position</span>: {</li><li>        <span class="hljs-attr">target</span>: {</li><li>          <span class="hljs-attr">latitude</span>: <span class="hljs-number">31.98</span>,</li><li>          <span class="hljs-attr">longitude</span>: <span class="hljs-number">118.7</span></li><li>        },</li><li>        <span class="hljs-attr">zoom</span>: <span class="hljs-number">7</span></li><li>      }</li><li>    }</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">callback</span> = <span class="hljs-keyword">async</span> (err, mapController) =&gt; {</li><li>      <span class="hljs-keyword">if</span> (!err) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapController</span> = mapController;</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">params</span>: mapCommon.<span class="hljs-property">TileOverlayOptions</span> = {</li><li>          <span class="hljs-comment">// 设置地图瓦片图层的地址,必须是以http或者https开头的URL且包含占位符{x}、{y}和{z}</span></li><li>          <span class="hljs-comment">// 需要替换为开发者自己的在线地址</span></li><li>          <span class="hljs-attr">tileUrl</span>: <span class="hljs-string">"https://xxx/xxx?x={x}&amp;y={y}&amp;z={z}"</span>,</li><li>          <span class="hljs-comment">// 透明度</span></li><li>          <span class="hljs-attr">transparency</span>: <span class="hljs-number">0.5</span>,</li><li>          <span class="hljs-comment">// 开启瓦片图层淡入</span></li><li>          <span class="hljs-attr">fadeIn</span>: <span class="hljs-literal">true</span></li><li>        };</li><li>        <span class="hljs-keyword">try</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">tileOverlay</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapController</span>?.<span class="hljs-title function_">addTileOverlay</span>(params);</li><li>        } <span class="hljs-keyword">catch</span> (e) {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`code:<span class="hljs-subst">${e.code}</span>, message:<span class="hljs-subst">${e.message}</span>`</span>);</li><li>        }</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to initialize the map, code is：<span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      }</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">MapComponent</span>({ <span class="hljs-attr">mapOptions</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapOptions</span>, <span class="hljs-attr">mapCallback</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">callback</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section392813231836">本地加载<i class="anchor-icon anchor-icon-link" anchorid="section392813231836" tips="复制节点链接"></i></h3>          <ol>      <li>导入相关模块。       <div _ngcontent-xtk-c106="" class="highlight-div"><div _ngcontent-xtk-c106="" class="highlight-div-header"><div _ngcontent-xtk-c106="" class="highlight-div-header-left"><div _ngcontent-xtk-c106="" class="handle-button expand-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xtk-c106="" class="highlight-div-header-right"><div _ngcontent-xtk-c106="" class="handle-button ai-button"></div><div _ngcontent-xtk-c106="" class="handle-button line-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xtk-c106="" class="handle-button theme-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xtk-c106="" class="handle-button copy-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xtk-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { mapCommon, map, <span class="hljs-title class_">MapComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MapKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AsyncCallback</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div></li>      <li><span style="color: rgb(38,38,38);">增加本地瓦片</span>图层。       <div _ngcontent-xtk-c106="" class="highlight-div"><div _ngcontent-xtk-c106="" class="highlight-div-header"><div _ngcontent-xtk-c106="" class="highlight-div-header-left"><div _ngcontent-xtk-c106="" class="handle-button expand-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xtk-c106="" class="highlight-div-header-right"><div _ngcontent-xtk-c106="" class="handle-button ai-button"></div><div _ngcontent-xtk-c106="" class="handle-button line-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xtk-c106="" class="handle-button theme-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xtk-c106="" class="handle-button copy-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xtk-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TileOverlayDemo</span> {</li><li>  <span class="hljs-keyword">private</span> mapOption?: mapCommon.<span class="hljs-property">MapOptions</span>;</li><li>  <span class="hljs-keyword">private</span> mapController?: map.<span class="hljs-property">MapComponentController</span>;</li><li>  <span class="hljs-keyword">private</span> callback?: <span class="hljs-title class_">AsyncCallback</span>&lt;map.<span class="hljs-property">MapComponentController</span>&gt;;</li><li>  <span class="hljs-keyword">private</span> tileOverlay?: map.<span class="hljs-property">TileOverlay</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapOption</span> = {</li><li>      <span class="hljs-attr">position</span>: {</li><li>        <span class="hljs-attr">target</span>: {</li><li>          <span class="hljs-attr">latitude</span>: <span class="hljs-number">31.98</span>,</li><li>          <span class="hljs-attr">longitude</span>: <span class="hljs-number">118.7</span></li><li>        },</li><li>        <span class="hljs-attr">zoom</span>: <span class="hljs-number">7</span></li><li>      },</li><li>      <span class="hljs-attr">scaleControlsEnabled</span>: <span class="hljs-literal">true</span></li><li>    }</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">callback</span> = <span class="hljs-keyword">async</span> (err, mapController) =&gt; {</li><li>      <span class="hljs-keyword">if</span> (!err) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapController</span> = mapController;</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">tileOverlayOption</span>: mapCommon.<span class="hljs-property">TileOverlayOptions</span> = {</li><li>          <span class="hljs-comment">// 根据瓦片坐标获取瓦片，本地获取瓦片方式需开发者自行实现tileProvider方法</span></li><li>          <span class="hljs-attr">tileProvider</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">tileProviderMethod</span>,</li><li>          <span class="hljs-comment">// 淡入淡出效果 true: 开启, false: 关闭</span></li><li>          <span class="hljs-attr">fadeIn</span>: <span class="hljs-literal">true</span>,</li><li>          <span class="hljs-comment">// 透明度, 取值范围 0-1</span></li><li>          <span class="hljs-attr">transparency</span>: <span class="hljs-number">0.5</span>,</li><li>          <span class="hljs-comment">// 可见性, true: 可见 false: 不可见</span></li><li>          <span class="hljs-attr">visible</span>: <span class="hljs-literal">true</span></li><li>        }</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">mapController</span> !== <span class="hljs-literal">undefined</span>) {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">tileOverlay</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapController</span>.<span class="hljs-title function_">addTileOverlay</span>(tileOverlayOption);</li><li>          } <span class="hljs-keyword">catch</span> (e) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`code:<span class="hljs-subst">${e.code}</span>, message:<span class="hljs-subst">${e.message}</span>`</span>);</li><li>          }</li><li>        }</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to initialize the map, code is：<span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      }</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 需要开发者自实现tileProviderMethod方法，负责加载本地项目中的瓦片图资源</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">tileProviderMethod</span>(<span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">z</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ArrayBuffer</span>&gt; {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {});</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">MapComponent</span>({ <span class="hljs-attr">mapOptions</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapOption</span>, <span class="hljs-attr">mapCallback</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">callback</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>);</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section102471510153">支持瓦片数据缓存<i class="anchor-icon anchor-icon-link" anchorid="section102471510153" tips="复制节点链接"></i></h3>          <ol>      <li>导入相关模块。       <div _ngcontent-xtk-c106="" class="highlight-div"><div _ngcontent-xtk-c106="" class="highlight-div-header"><div _ngcontent-xtk-c106="" class="highlight-div-header-left"><div _ngcontent-xtk-c106="" class="handle-button expand-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xtk-c106="" class="highlight-div-header-right"><div _ngcontent-xtk-c106="" class="handle-button ai-button"></div><div _ngcontent-xtk-c106="" class="handle-button line-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xtk-c106="" class="handle-button theme-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xtk-c106="" class="handle-button copy-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xtk-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { mapCommon, map, <span class="hljs-title class_">MapComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MapKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AsyncCallback</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div></li>      <li><span style="color: rgb(38,38,38);">增加瓦片</span>图层。       <div _ngcontent-xtk-c106="" class="highlight-div"><div _ngcontent-xtk-c106="" class="highlight-div-header"><div _ngcontent-xtk-c106="" class="highlight-div-header-left"><div _ngcontent-xtk-c106="" class="handle-button expand-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xtk-c106="" class="highlight-div-header-right"><div _ngcontent-xtk-c106="" class="handle-button ai-button"></div><div _ngcontent-xtk-c106="" class="handle-button line-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xtk-c106="" class="handle-button theme-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xtk-c106="" class="handle-button copy-button"><div _ngcontent-xtk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xtk-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TileOverlayDemo</span> {</li><li>  <span class="hljs-keyword">private</span> mapOption?: mapCommon.<span class="hljs-property">MapOptions</span>;</li><li>  <span class="hljs-keyword">private</span> mapController?: map.<span class="hljs-property">MapComponentController</span>;</li><li>  <span class="hljs-keyword">private</span> callback?: <span class="hljs-title class_">AsyncCallback</span>&lt;map.<span class="hljs-property">MapComponentController</span>&gt;;</li><li>  <span class="hljs-keyword">private</span> tileOverlay?: map.<span class="hljs-property">TileOverlay</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapOption</span> = {</li><li>      <span class="hljs-attr">position</span>: {</li><li>        <span class="hljs-attr">target</span>: {</li><li>          <span class="hljs-attr">latitude</span>: <span class="hljs-number">48.87278</span>,</li><li>          <span class="hljs-attr">longitude</span>: <span class="hljs-number">2.33016</span></li><li>        },</li><li>        <span class="hljs-attr">zoom</span>: <span class="hljs-number">4</span></li><li>      },</li><li>      <span class="hljs-attr">scaleControlsEnabled</span>: <span class="hljs-literal">true</span></li><li>    }</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">callback</span> = <span class="hljs-keyword">async</span> (err, mapController) =&gt; {</li><li>      <span class="hljs-keyword">if</span> (!err) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapController</span> = mapController;</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: mapCommon.<span class="hljs-property">TileOverlayOptions</span> = {</li><li>          <span class="hljs-comment">// 设置地图瓦片图层的地址, 必须是以http或者https开头的URL且包含占位符{x}、{y}和{z}</span></li><li>          <span class="hljs-comment">// 需要替换为开发者自己的在线地址</span></li><li>          <span class="hljs-attr">tileUrl</span>: <span class="hljs-string">"https://xxx/xxx?x={x}&amp;y={y}&amp;z={z}"</span>,</li><li>          <span class="hljs-comment">// 是否开启磁盘缓存 true: 开启, false: 关闭</span></li><li>          <span class="hljs-attr">diskCacheEnabled</span>: <span class="hljs-literal">true</span>,</li><li>          <span class="hljs-comment">// 磁盘缓存大小 默认大小 20480KB, 单位KB</span></li><li>          <span class="hljs-attr">diskCacheSize</span>: <span class="hljs-number">20480</span>,</li><li>          <span class="hljs-comment">// 存放磁盘缓存的沙箱路径</span></li><li>          <span class="hljs-attr">diskCachePath</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>()?.<span class="hljs-property">databaseDir</span></li><li>        };</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">mapController</span> !== <span class="hljs-literal">undefined</span>) {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">tileOverlay</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapController</span>.<span class="hljs-title function_">addTileOverlay</span>(options);</li><li>          } <span class="hljs-keyword">catch</span> (e) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`code:<span class="hljs-subst">${e.code}</span>, message:<span class="hljs-subst">${e.message}</span>`</span>);</li><li>          }</li><li>        }</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to initialize the map, code is：<span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      }</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">tileOverlay</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tileOverlay</span>.<span class="hljs-title function_">remove</span>();</li><li>      <span class="hljs-comment">// 清除内存缓存</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tileOverlay</span>.<span class="hljs-title function_">clearTileCache</span>();</li><li>      <span class="hljs-comment">// 清除磁盘和内存缓存</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tileOverlay</span>.<span class="hljs-title function_">clearDiskCache</span>();</li><li>   }</li><li> }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">MapComponent</span>({ <span class="hljs-attr">mapOptions</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapOption</span>, <span class="hljs-attr">mapCallback</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">callback</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>);</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>