<h1 _ngcontent-prh-c119="" class="doc-title ng-star-inserted" title="显示我的位置"> 显示我的位置 </h1>

<div _ngcontent-prh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section1880231055910">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section1880231055910" tips="复制节点链接"></i></h2>          <p>从6.0.1(21)开始，支持更改我的位置相对覆盖物的顺序。</p>     <p>本章节将向您介绍如何开启和展示<span class="uicontrol">“我的位置”</span>功能，<span class="uicontrol">“我的位置”</span>指的是进入地图后点击<span class="uicontrol">“我的位置”</span>显示当前位置点的功能。效果如下：</p>     <p><span><img originheight="529" originwidth="414" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114557.98211097915649869761282884542592:50001231000000:2800:E0CC02D9DB993D5823AA5A5672EDA5E0BB781343499E51C636D02575620B08FE.png" width="414" height="529"></span></p>    </div>    <div class="tiledSection">     <h2 id="section41628814378">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section41628814378" tips="复制节点链接"></i></h2>          <p><span class="uicontrol">“我的位置”</span>功能主要由<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-mapcomponentcontroller" target="_blank">MapComponentController</a>的方法实现，更多接口及使用方法请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-mapcomponentcontroller#section201759451313" target="_blank">接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="53.09%">          <p>方法名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="46.910000000000004%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="53.09%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-mapcomponentcontroller#section201759451313" target="_blank">setMyLocationEnabled</a>(myLocationEnabled: boolean): void</p></td>         <td class="cellrowborder" valign="top" width="46.910000000000004%">          <p><span class="uicontrol">“我的位置”</span>图层功能开关，默认使用系统的连续定位能力显示用户位置。开关打开后，“我的位置”按钮默认显示在地图的右下角。点击“我的位置”按钮，将会在屏幕中心显示当前定位，以蓝色圆点的形式呈现。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.09%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-mapcomponentcontroller#section3464719101814" target="_blank">setMyLocationControlsEnabled</a>(enabled: boolean): void</p></td>         <td class="cellrowborder" valign="top" width="46.910000000000004%">          <p>设置是否启用<span class="uicontrol">“我的位置”</span>按钮。只显示按钮，在不开启<span class="uicontrol">“我的位置”</span>图层功能的情况下，点击按钮没反应。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.09%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-mapcomponentcontroller#section1165002535516" target="_blank">setMyLocation</a>(location: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-geolocationmanager#location" target="_blank">geoLocationManager.Location</a>): void</p></td>         <td class="cellrowborder" valign="top" width="46.910000000000004%">          <p>设置<span class="uicontrol">“我的位置”</span>坐标。</p>          <p>如果不使用Map Kit提供的默认定位行为，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/location-api" target="_blank">Location Kit</a>获取用户位置后，传给Map Kit。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.09%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-mapcomponentcontroller#section126791641317" target="_blank">setMyLocationStyle</a>(style: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-common#section3713124215275" target="_blank">mapCommon.MyLocationStyle</a>): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="46.910000000000004%">          <p>设置<span class="uicontrol">“我的位置”</span>样式。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.09%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-mapcomponentcontroller#section1446539113513" target="_blank">on</a>(type: 'myLocationButtonClick', callback: Callback&lt;void&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="46.910000000000004%">          <p>监听“我的位置”按钮点击事件。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.09%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-mapcomponentcontroller#section546609133518" target="_blank">off</a>(type: 'myLocationButtonClick', callback?: Callback&lt;void&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="46.910000000000004%">          <p>取消监听<span class="uicontrol">“我的位置”</span>按钮点击事件。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section9187179113620">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section9187179113620" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section550812311069" class="firsth2">开启<span class="uicontrol">“我的位置”</span>按钮<i class="anchor-icon anchor-icon-link" anchorid="section550812311069" tips="复制节点链接"></i></h3>          <ol>      <li>启用“我的位置”之前，您需要确保您的应用可以获取用户定位。       <p>申请ohos.permission.LOCATION和ohos.permission.APPROXIMATELY_LOCATION权限，您需要在module.json5配置文件中声明所需要的权限，具体可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions" target="_blank">声明权限</a>。</p>       <div _ngcontent-prh-c106="" class="highlight-div"><div _ngcontent-prh-c106="" class="highlight-div-header"><div _ngcontent-prh-c106="" class="highlight-div-header-left"><div _ngcontent-prh-c106="" class="handle-button expand-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-prh-c106="" class="highlight-div-header-right"><div _ngcontent-prh-c106="" class="handle-button ai-button"></div><div _ngcontent-prh-c106="" class="handle-button line-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-prh-c106="" class="handle-button theme-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-prh-c106="" class="handle-button copy-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-prh-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"module"</span> : {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-string">"requestPermissions"</span>:[</li><li>      {</li><li>        <span class="hljs-comment">// 允许应用在前台运行时获取位置信息</span></li><li>        <span class="hljs-string">"name"</span> : <span class="hljs-string">"ohos.permission.LOCATION"</span>,</li><li>        <span class="hljs-comment">// reason需要在/resources/base/element/string.json中新建</span></li><li>        <span class="hljs-string">"reason"</span>: <span class="hljs-string">"$string:location_permission"</span>,</li><li>        <span class="hljs-string">"usedScene"</span>: {</li><li>          <span class="hljs-string">"abilities"</span>: [</li><li>            <span class="hljs-string">"EntryAbility"</span></li><li>          ],</li><li>          <span class="hljs-string">"when"</span>:<span class="hljs-string">"inuse"</span></li><li>        }</li><li>      },</li><li>      {</li><li>        <span class="hljs-comment">// 允许应用获取设备模糊位置信息</span></li><li>        <span class="hljs-string">"name"</span> : <span class="hljs-string">"ohos.permission.APPROXIMATELY_LOCATION"</span>,</li><li>        <span class="hljs-comment">// reason需要在/resources/base/element/string.json中新建</span></li><li>        <span class="hljs-string">"reason"</span>: <span class="hljs-string">"$string:approximately_location_permission"</span>,</li><li>        <span class="hljs-string">"usedScene"</span>: {</li><li>          <span class="hljs-string">"abilities"</span>: [</li><li>            <span class="hljs-string">"EntryAbility"</span></li><li>          ],</li><li>          <span class="hljs-string">"when"</span>:<span class="hljs-string">"inuse"</span></li><li>        }</li><li>      }</li><li>    ]</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>初始化地图并获取<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-mapcomponentcontroller" target="_blank">MapComponentController</a>地图操作类对象。调用mapController对象的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-mapcomponentcontroller#section201759451313" target="_blank">setMyLocationEnabled</a>方法启用<span class="parmvalue">“我的位置”</span>功能。       <div class="p">        建议在获得用户授权后开启“我的位置”功能。        <div _ngcontent-prh-c106="" class="highlight-div"><div _ngcontent-prh-c106="" class="highlight-div-header"><div _ngcontent-prh-c106="" class="highlight-div-header-left"><div _ngcontent-prh-c106="" class="handle-button expand-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-prh-c106="" class="highlight-div-header-right"><div _ngcontent-prh-c106="" class="handle-button ai-button"></div><div _ngcontent-prh-c106="" class="handle-button line-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-prh-c106="" class="handle-button theme-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-prh-c106="" class="handle-button copy-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-prh-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { abilityAccessCtrl, bundleManager, common, <span class="hljs-title class_">PermissionRequestResult</span>, <span class="hljs-title class_">Permissions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span>, <span class="hljs-title class_">AsyncCallback</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MapComponent</span>, mapCommon, map } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MapKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">LocationDemo</span> {</li><li>  <span class="hljs-keyword">private</span> mapOptions?: mapCommon.<span class="hljs-property">MapOptions</span>;</li><li>  <span class="hljs-keyword">private</span> callback?: <span class="hljs-title class_">AsyncCallback</span>&lt;map.<span class="hljs-property">MapComponentController</span>&gt;;</li><li>  <span class="hljs-keyword">private</span> mapController?: map.<span class="hljs-property">MapComponentController</span>;</li><li>  <span class="hljs-keyword">private</span> mapEventManager?: map.<span class="hljs-property">MapEventManager</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 地图初始化参数，设置地图中心点坐标及层级</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapOptions</span> = {</li><li>      <span class="hljs-attr">position</span>: {</li><li>        <span class="hljs-attr">target</span>: {</li><li>          <span class="hljs-attr">latitude</span>: <span class="hljs-number">39.9</span>,</li><li>          <span class="hljs-attr">longitude</span>: <span class="hljs-number">116.4</span></li><li>        },</li><li>        <span class="hljs-attr">zoom</span>: <span class="hljs-number">10</span></li><li>      }</li><li>    };</li><li>
</li><li>    <span class="hljs-comment">// 地图初始化的回调</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">callback</span> = <span class="hljs-keyword">async</span> (err, mapController) =&gt; {</li><li>      <span class="hljs-keyword">if</span> (!err) {</li><li>        <span class="hljs-comment">// 获取地图的控制器类，用来操作地图</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapController</span> = mapController;</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapEventManager</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapController</span>.<span class="hljs-title function_">getEventManager</span>();</li><li>        <span class="hljs-keyword">let</span> permission = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkPermissions</span>()</li><li>        <span class="hljs-keyword">if</span> (!permission) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">requestPermissions</span>()</li><li>          <span class="hljs-comment">// 启用我的位置按钮</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapController</span>?.<span class="hljs-title function_">setMyLocationControlsEnabled</span>(<span class="hljs-literal">true</span>);</li><li>        }</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to initialize the map, code is：<span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      }</li><li>    };</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 校验应用是否被授予定位权限，可以通过调用checkAccessToken()方法来校验当前是否已经授权。</span></li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">checkPermissions</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">permissions</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Permissions</span>&gt; = [<span class="hljs-string">'ohos.permission.LOCATION'</span>, <span class="hljs-string">'ohos.permission.APPROXIMATELY_LOCATION'</span>];</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> permission <span class="hljs-keyword">of</span> permissions) {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">grantStatus</span>: abilityAccessCtrl.<span class="hljs-property">GrantStatus</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkAccessToken</span>(permission);</li><li>      <span class="hljs-keyword">if</span> (grantStatus === abilityAccessCtrl.<span class="hljs-property">GrantStatus</span>.<span class="hljs-property">PERMISSION_GRANTED</span>) {</li><li>        <span class="hljs-comment">// 启用我的位置图层，mapController为地图操作类对象</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapController</span>?.<span class="hljs-title function_">setMyLocationEnabled</span>(<span class="hljs-literal">true</span>);</li><li>        <span class="hljs-comment">// 启用我的位置按钮</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapController</span>?.<span class="hljs-title function_">setMyLocationControlsEnabled</span>(<span class="hljs-literal">true</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 如果没有被授予定位权限，动态向用户申请授权</span></li><li>  <span class="hljs-title function_">requestPermissions</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">atManager</span>: abilityAccessCtrl.<span class="hljs-property">AtManager</span> = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();</li><li>    atManager.<span class="hljs-title function_">requestPermissionsFromUser</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>,</li><li>      [<span class="hljs-string">'ohos.permission.LOCATION'</span>, <span class="hljs-string">'ohos.permission.APPROXIMATELY_LOCATION'</span>])</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: PermissionRequestResult</span>) =&gt;</span> {</li><li>        <span class="hljs-comment">// 启用我的位置图层</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapController</span>?.<span class="hljs-title function_">setMyLocationEnabled</span>(<span class="hljs-literal">true</span>);</li><li>      })</li><li>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to request permissions from user. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      })</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">checkAccessToken</span>(<span class="hljs-attr">permission</span>: <span class="hljs-title class_">Permissions</span>): <span class="hljs-title class_">Promise</span>&lt;abilityAccessCtrl.<span class="hljs-property">GrantStatus</span>&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">atManager</span>: abilityAccessCtrl.<span class="hljs-property">AtManager</span> = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">grantStatus</span>: abilityAccessCtrl.<span class="hljs-property">GrantStatus</span> = abilityAccessCtrl.<span class="hljs-property">GrantStatus</span>.<span class="hljs-property">PERMISSION_DENIED</span>;</li><li>
</li><li>    <span class="hljs-comment">// 获取应用程序的accessTokenID</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">tokenId</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">bundleInfo</span>: bundleManager.<span class="hljs-property">BundleInfo</span> =</li><li>      <span class="hljs-keyword">await</span> bundleManager.<span class="hljs-title function_">getBundleInfoForSelf</span>(bundleManager.<span class="hljs-property">BundleFlag</span>.<span class="hljs-property">GET_BUNDLE_INFO_WITH_APPLICATION</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in getting Bundle.'</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">appInfo</span>: bundleManager.<span class="hljs-property">ApplicationInfo</span> = bundleInfo.<span class="hljs-property">appInfo</span>;</li><li>    tokenId = appInfo.<span class="hljs-property">accessTokenId</span>;</li><li>
</li><li>    <span class="hljs-comment">// 校验应用是否被授予权限</span></li><li>    grantStatus = <span class="hljs-keyword">await</span> atManager.<span class="hljs-title function_">checkAccessToken</span>(tokenId, permission);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in checking access token.'</span>);</li><li>    <span class="hljs-keyword">return</span> grantStatus;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>() {</li><li>      <span class="hljs-comment">// 调用MapComponent组件初始化地图</span></li><li>      <span class="hljs-title class_">MapComponent</span>({ <span class="hljs-attr">mapOptions</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapOptions</span>, <span class="hljs-attr">mapCallback</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">callback</span> }).<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>);</li><li>    }.<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>       </div></li>      <li>检查<span class="uicontrol">“我的位置”</span>功能是否成功启用。       <p><span class="uicontrol">“我的位置”</span>按钮<span><img originheight="18" originwidth="19" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114557.48337009073000327661056049976176:50001231000000:2800:8A09BF6F6820D8118669DC2584DE18F59D742DBD9146DB69F13761B2BD434D85.png" class="IconPic notEnlarge" width="19" height="18"></span>默认显示在地图的右下角。点击<span class="uicontrol">“我的位置”</span>按钮<span><img originheight="18" originwidth="19" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114557.27006469417500793344408854181694:50001231000000:2800:8E437182036CE0C129D1746465F3CDAD5AD0B09FA37687B88DDC4D558EB82B44.png" class="IconPic notEnlarge" width="19" height="18"></span>，将会在屏幕中心显示当前定位，以蓝色圆点的形式呈现，效果如下图所示，效果根据获取到的用户位置会有变化。</p>       <p><span><img originheight="529" originwidth="414" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114557.99908561603917672044446346343274:50001231000000:2800:3B39FC56EFDC66F46C0901A9BB7617D84285E0904BE5C889EBAB3A39C22EA505.png" width="414" height="529"></span></p></li>      <li>获取用户位置坐标并设置用户的位置。       <p>Map Kit默认使用系统的连续定位能力，如果您希望定制显示频率或者精准度，可以调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-geolocationmanager" target="_blank">geoLocationManager</a>相关接口获取用户位置坐标（WGS84坐标系）。<span style="color: rgb(36,39,40);">注意</span><span style="color: rgb(36,39,40);">访问设备的位置信息必须申请权限，并且获得用户授权，详情见</span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-geolocationmanager" target="_blank">geoLocationManager</a><span style="color: rgb(36,39,40);">。</span></p>       <div class="p">        <span style="color: rgb(36,39,40);">下面的示例仅显示一次定位结果，在获取到用户坐标后，</span>调用mapController对象的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-mapcomponentcontroller#section1165002535516" target="_blank">setMyLocation</a>设置用户的位置，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-mapcomponentcontroller#section1165002535516" target="_blank">setMyLocation</a>接口使用的是WGS84坐标系。        <div _ngcontent-prh-c106="" class="highlight-div"><div _ngcontent-prh-c106="" class="highlight-div-header"><div _ngcontent-prh-c106="" class="highlight-div-header-left"><div _ngcontent-prh-c106="" class="handle-button expand-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-prh-c106="" class="highlight-div-header-right"><div _ngcontent-prh-c106="" class="handle-button ai-button"></div><div _ngcontent-prh-c106="" class="handle-button line-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-prh-c106="" class="handle-button theme-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-prh-c106="" class="handle-button copy-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-prh-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 需要引入@kit.LocationKit模块</span></li><li><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;</li><li><span class="hljs-comment">// ...</span></li><li>
</li><li><span class="hljs-comment">// 获取用户位置坐标</span></li><li><span class="hljs-keyword">let</span> location = <span class="hljs-keyword">await</span> geoLocationManager.<span class="hljs-title function_">getCurrentLocation</span>();</li><li>
</li><li><span class="hljs-comment">// 设置用户的位置</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">mapController</span>.<span class="hljs-title function_">setMyLocation</span>(location);</li></ol></pre></div></div>       </div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section113474617342">监听“我的位置”按钮点击事件<i class="anchor-icon anchor-icon-link" anchorid="section113474617342" tips="复制节点链接"></i></h3>          <p>通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-mapcomponentcontroller#section1446539113513" target="_blank">on('myLocationButtonClick')</a>方法，设置'myLocationButtonClick'事件监听。设置监听后“我的位置按钮”点击事件自定义，反之不设置则由Map Kit执行点击后默认事件，即地图移动到当前用户位置。</p>     <div _ngcontent-prh-c106="" class="highlight-div"><div _ngcontent-prh-c106="" class="highlight-div-header"><div _ngcontent-prh-c106="" class="highlight-div-header-left"><div _ngcontent-prh-c106="" class="handle-button expand-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-prh-c106="" class="highlight-div-header-right"><div _ngcontent-prh-c106="" class="handle-button ai-button"></div><div _ngcontent-prh-c106="" class="handle-button line-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-prh-c106="" class="handle-button theme-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-prh-c106="" class="handle-button copy-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-prh-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-title function_">callback</span> = (<span class="hljs-params"></span>) =&gt; {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"myLocationButtonClick"</span>, <span class="hljs-string">`myLocationButtonClick`</span>);</li><li>};</li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">mapEventManager</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">"myLocationButtonClick"</span>, callback);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section1785017401883">隐藏<span class="uicontrol">“我的位置”</span>按钮<i class="anchor-icon anchor-icon-link" anchorid="section1785017401883" tips="复制节点链接"></i></h3>          <div class="p">      控制是否显示<span class="uicontrol">“我的位置”</span>按钮。      <div _ngcontent-prh-c106="" class="highlight-div"><div _ngcontent-prh-c106="" class="highlight-div-header"><div _ngcontent-prh-c106="" class="highlight-div-header-left"><div _ngcontent-prh-c106="" class="handle-button expand-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-prh-c106="" class="highlight-div-header-right"><div _ngcontent-prh-c106="" class="handle-button ai-button"></div><div _ngcontent-prh-c106="" class="handle-button line-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-prh-c106="" class="handle-button theme-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-prh-c106="" class="handle-button copy-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-prh-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">mapController</span>.<span class="hljs-title function_">setMyLocationControlsEnabled</span>(<span class="hljs-literal">false</span>);</li></ol></pre></div></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section125941742161216">自定义位置图标样式<i class="anchor-icon anchor-icon-link" anchorid="section125941742161216" tips="复制节点链接"></i></h3>          <div class="p">      通过调用mapController.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-mapcomponentcontroller#section126791641317" target="_blank">setMyLocationStyle</a>方法，设置用户位置图标样式。效果如下：      <div _ngcontent-prh-c106="" class="highlight-div"><div _ngcontent-prh-c106="" class="highlight-div-header"><div _ngcontent-prh-c106="" class="highlight-div-header-left"><div _ngcontent-prh-c106="" class="handle-button expand-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-prh-c106="" class="highlight-div-header-right"><div _ngcontent-prh-c106="" class="handle-button ai-button"></div><div _ngcontent-prh-c106="" class="handle-button line-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-prh-c106="" class="handle-button theme-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-prh-c106="" class="handle-button copy-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-prh-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">style</span>: mapCommon.<span class="hljs-property">MyLocationStyle</span> = {</li><li>  <span class="hljs-attr">anchorU</span>: <span class="hljs-number">0.5</span>,</li><li>  <span class="hljs-attr">anchorV</span>: <span class="hljs-number">0.5</span>,</li><li>  <span class="hljs-attr">radiusFillColor</span>: <span class="hljs-number">0xffff0000</span>,</li><li>  <span class="hljs-comment">// icon为自定义图标资源，使用时需要替换</span></li><li>  <span class="hljs-comment">// 图标存放在resources/rawfile，icon参数传入rawfile文件夹下的相对路径</span></li><li>  <span class="hljs-attr">icon</span>: <span class="hljs-string">'test.png'</span></li><li>};</li><li><span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapController</span>.<span class="hljs-title function_">setMyLocationStyle</span>(style);</li></ol></pre></div></div>     </div>     <p><span><img originheight="523" originwidth="410" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114557.68424640828265045095981586295608:50001231000000:2800:816E4AD53A7982DE71FB0E55F6E9FB9CB893C1409E5EDCA3AEFA071430CC5D11.png" width="410" height="523"></span></p>    </div>    <div class="tiledSection">     <h3 id="section72391953142617">更改我的位置图层相对于覆盖物的压盖顺序<i class="anchor-icon anchor-icon-link" anchorid="section72391953142617" tips="复制节点链接"></i></h3>          <div class="p">      通过调用mapController.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/map-map-mapcomponentcontroller#section16251915293" target="_blank">changeMyLocationLayerOrder</a>方法，更改我的位置图层相对于覆盖物的压盖顺序。效果如下：      <div _ngcontent-prh-c106="" class="highlight-div"><div _ngcontent-prh-c106="" class="highlight-div-header"><div _ngcontent-prh-c106="" class="highlight-div-header-left"><div _ngcontent-prh-c106="" class="handle-button expand-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-prh-c106="" class="highlight-div-header-right"><div _ngcontent-prh-c106="" class="handle-button ai-button"></div><div _ngcontent-prh-c106="" class="handle-button line-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-prh-c106="" class="handle-button theme-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-prh-c106="" class="handle-button copy-button"><div _ngcontent-prh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-prh-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// true：我的位置图层位于覆盖物之下</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">mapController</span>?.<span class="hljs-title function_">changeMyLocationLayerOrder</span>(<span class="hljs-literal">true</span>);</li></ol></pre></div></div>     </div>     <p><span><img height="664.170479" originheight="2403" originwidth="1209" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114557.90689397144002808953682389521198:50001231000000:2800:D69B1FE58C6626E25557B70E91A050D52505CA19B3DFD9DAE2C6BAFF0ED6CB92.jpg" title="点击放大" width="334.1625"></span></p>    </div>   </div>   <div></div></div>