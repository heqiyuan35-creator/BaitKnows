/**
 * ç²¾ç¡®åŒ¹é…åŠŸèƒ½ - ç±»å‹å®šä¹‰
 */
import { RecipeWaterType, RecipeSeason, GeneratedRecipe, RecipeIngredient } from './RecipeTypes';

// ==================== é«˜çº§å‚æ•°ç±»å‹ ====================

// æ°´æ·±
export type WaterDepth = 'shallow' | 'medium' | 'deep';
export const WaterDepthNames: Record<WaterDepth, string> = {
  'shallow': 'æµ…æ°´(<1m)',
  'medium': 'ä¸­å±‚(1-3m)',
  'deep': 'æ·±æ°´(>3m)'
};

// æ°´è´¨
export type WaterQuality = 'clear' | 'slight_muddy' | 'muddy' | 'fertile';
export const WaterQualityNames: Record<WaterQuality, string> = {
  'clear': 'æ¸…æ¾ˆ',
  'slight_muddy': 'å¾®æµ‘',
  'muddy': 'æµ‘æµŠ',
  'fertile': 'è‚¥æ°´'
};

// å…‰ç…§æ¡ä»¶
export type LightCondition = 'bright' | 'cloudy' | 'dawn_dusk' | 'night';
export const LightConditionNames: Record<LightCondition, string> = {
  'bright': 'å¼ºå…‰',
  'cloudy': 'é˜´å¤©',
  'dawn_dusk': 'æ™¨æ˜',
  'night': 'å¤œé’“'
};

// é£åŠ›æ¡ä»¶
export type WindCondition = 'none' | 'light' | 'medium' | 'strong';
export const WindConditionNames: Record<WindCondition, string> = {
  'none': 'æ— é£',
  'light': 'å¾®é£',
  'medium': 'ä¸­é£',
  'strong': 'å¤§é£'
};

// é¥µæ–™çŠ¶æ€åå¥?
export type BaitState = 'fast_dissolve' | 'slow_dissolve' | 'sticky' | 'dry_loose';
export const BaitStateNames: Record<BaitState, string> = {
  'fast_dissolve': 'é›¾åŒ–å¿?,
  'slow_dissolve': 'é›¾åŒ–æ…?,
  'sticky': 'ç²˜è½¯',
  'dry_loose': 'å¹²æ•£'
};

// å‘³å‹å¼ºåº¦
export type FlavorIntensity = 'light' | 'medium' | 'strong' | 'intense';
export const FlavorIntensityNames: Record<FlavorIntensity, string> = {
  'light': 'æ¸…æ·¡',
  'medium': 'é€‚ä¸­',
  'strong': 'æµ“éƒ',
  'intense': 'åˆºæ¿€'
};

// ç›®æ ‡é±¼ä½“å?
export type FishSize = 'small' | 'medium' | 'large';
export const FishSizeNames: Record<FishSize, string> = {
  'small': 'å°å‹(<1æ–?',
  'medium': 'ä¸­å‹(1-5æ–?',
  'large': 'å¤§å‹(>5æ–?'
};

// ==================== ç²¾ç¡®åŒ¹é…è¾“å…¥ ====================

export class PreciseMatchInput {
  // åŸºç¡€å‚æ•°
  targetFish: string = '';
  waterType: RecipeWaterType = 'river';
  season: RecipeSeason = 'spring';
  temperature: number = 20;

  // é«˜çº§å‚æ•°
  waterDepth: WaterDepth = 'medium';
  waterQuality: WaterQuality = 'clear';
  lightCondition: LightCondition = 'bright';
  windCondition: WindCondition = 'none';
  baitState: BaitState = 'fast_dissolve';
  flavorIntensity: FlavorIntensity = 'medium';
  targetFishSize: FishSize = 'medium';

  constructor() {}
}

// ==================== ç»´åº¦è¯„åˆ† ====================

export class DimensionScores {
  attraction: number = 0;      // è¯±é±¼æ€?0-100
  palatability: number = 0;    // é€‚å£æ€?0-100
  state: number = 0;           // çŠ¶æ€?0-100
  retention: number = 0;       // ç•™é±¼æ€?0-100
  costEffective: number = 0;   // æ€§ä»·æ¯?0-100

  constructor() {}

  // è®¡ç®—å¹³å‡åˆ?
  getAverage(): number {
    return Math.round((this.attraction + this.palatability + this.state +
      this.retention + this.costEffective) / 5);
  }
}

// ==================== å‚æ•°æƒé‡ ====================

export class ParameterWeight {
  name: string = '';           // å‚æ•°åç§°
  weight: number = 0;          // æƒé‡å€?0-100
  impact: string = '';         // å½±å“è¯´æ˜

  constructor() {}

  static create(name: string, weight: number, impact: string): ParameterWeight {
    const p = new ParameterWeight();
    p.name = name;
    p.weight = weight;
    p.impact = impact;
    return p;
  }
}

// ==================== åˆ†ææ­¥éª¤ ====================

export class AnalysisStep {
  step: number = 0;
  title: string = '';
  description: string = '';
  keyData: string = '';
  progress: number = 0;        // 0-100

  constructor() {}

  static create(step: number, title: string, desc: string, data: string): AnalysisStep {
    const s = new AnalysisStep();
    s.step = step;
    s.title = title;
    s.description = desc;
    s.keyData = data;
    s.progress = step * 20;
    return s;
  }
}

// ==================== åŸæ–™é…æ¯” ====================

export class IngredientRatio {
  name: string = '';
  category: string = '';       // åŸºç¡€é¥?ä¸»æ”»é¥?çŠ¶æ€é¥µ/æ·»åŠ å‰?
  percentage: number = 0;
  color: string = '#E6A23C';

  constructor() {}

  static create(name: string, category: string, percentage: number, color: string): IngredientRatio {
    const r = new IngredientRatio();
    r.name = name;
    r.category = category;
    r.percentage = percentage;
    r.color = color;
    return r;
  }
}

// ==================== ç²¾ç¡®åŒ¹é…ç»“æœ ====================

export class PreciseMatchResult {
  recipe: GeneratedRecipe = new GeneratedRecipe();
  matchScore: number = 0;                          // 0-100 åŒ¹é…åº?
  dimensionScores: DimensionScores = new DimensionScores();
  parameterWeights: ParameterWeight[] = [];
  analysisSteps: AnalysisStep[] = [];
  ingredientRatios: IngredientRatio[] = [];
  alternatives: GeneratedRecipe[] = [];            // å¤‡é€‰æ–¹æ¡?
  scoreDescription: string = '';                   // è¯„åˆ†è¯´æ˜

  constructor() {}

  // è·å–è¯„åˆ†ç­‰çº§æè¿°
  getScoreLevel(): string {
    if (this.matchScore >= 90) return 'éå¸¸é€‚åˆå½“å‰é’“å†µ';
    if (this.matchScore >= 80) return 'å¾ˆé€‚åˆå½“å‰é’“å†µ';
    if (this.matchScore >= 70) return 'é€‚åˆå½“å‰é’“å†µ';
    if (this.matchScore >= 60) return 'åŸºæœ¬é€‚åˆ';
    return 'å»ºè®®è°ƒæ•´å‚æ•°';
  }
}

// ==================== åé¦ˆé€‰é¡¹ ====================

export type FeedbackType = 'flavor_dislike' | 'ingredient_hard' | 'state_wrong' |
  'want_more_fishy' | 'want_more_fragrant' | 'want_lighter' | 'other';

export class FeedbackOption {
  id: FeedbackType = 'other';
  label: string = '';
  icon: string = '';
  adjustmentType: string = '';  // flavor/ingredient/state/intensity

  constructor() {}

  static create(id: FeedbackType, label: string, icon: string, type: string): FeedbackOption {
    const f = new FeedbackOption();
    f.id = id;
    f.label = label;
    f.icon = icon;
    f.adjustmentType = type;
    return f;
  }
}

// é¢„å®šä¹‰åé¦ˆé€‰é¡¹
export const FEEDBACK_OPTIONS: FeedbackOption[] = [
  FeedbackOption.create('flavor_dislike', 'å‘³å‹ä¸å–œæ¬?, 'ğŸ‘ƒ', 'flavor'),
  FeedbackOption.create('ingredient_hard', 'åŸæ–™éš¾è·å?, 'ğŸ›’', 'ingredient'),
  FeedbackOption.create('state_wrong', 'çŠ¶æ€ä¸åˆé€?, 'ğŸ’§', 'state'),
  FeedbackOption.create('want_more_fishy', 'æƒ³è¦æ›´è…¥', 'ğŸŸ', 'intensity'),
  FeedbackOption.create('want_more_fragrant', 'æƒ³è¦æ›´é¦™', 'ğŸŒ¸', 'intensity'),
  FeedbackOption.create('want_lighter', 'æƒ³è¦æ›´æ·¡', 'ğŸ’¨', 'intensity'),
  FeedbackOption.create('other', 'å…¶ä»–åŸå› ', 'ğŸ’¬', 'other')
];

// ==================== ç”¨æˆ·åé¦ˆè®°å½• ====================

export class UserFeedback {
  recipeId: string = '';
  feedbackTypes: FeedbackType[] = [];
  otherReason: string = '';
  timestamp: number = 0;

  constructor() {}
}
