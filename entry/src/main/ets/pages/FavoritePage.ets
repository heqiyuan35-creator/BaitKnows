/**
 * é¥µçŸ¥é“ - æ”¶è—é¡µé¢
 * å±•ç¤ºç”¨æˆ·æ”¶è—çš„é…æ–¹
 */
import { ThemeColors } from '../theme/ThemeColors';
import { ThemeConstants } from '../theme/ThemeConstants';
import { Router } from '../router/Router';
import { AppConstants } from '../common/constants/AppConstants';

// æ”¶è—é…æ–¹æŽ¥å£
interface FavoriteRecipe {
  id: string;
  name: string;
  targetFish: string;
  rating: number;
  usageCount: number;
  addTime: string;
}

@Entry
@Component
struct FavoritePage {
  @State favorites: FavoriteRecipe[] = [];

  aboutToAppear(): void {
    this.loadFavorites();
  }

  private loadFavorites(): void {
    // æ¨¡æ‹Ÿæ•°æ®
    this.favorites = [
      { id: 'fav_001', name: 'ç»å…¸çŽ‰ç±³é…’é¦™é¥µ', targetFish: 'é²¤é±¼', rating: 4.8, usageCount: 12, addTime: '10æœˆ20æ—¥' },
      { id: 'fav_002', name: 'ç§‹å­£çº¢è™«ç²‰', targetFish: 'é²«é±¼', rating: 4.5, usageCount: 8, addTime: '10æœˆ15æ—¥' },
      { id: 'fav_003', name: 'é‡Žé’“ä¸‡èƒ½é¥µ', targetFish: 'è‰é±¼', rating: 4.6, usageCount: 5, addTime: '10æœˆ10æ—¥' }
    ];
  }

  build() {
    Column() {
      this.HeaderBar()

      if (this.favorites.length === 0) {
        this.EmptyState()
      } else {
        Scroll() {
          Column({ space: ThemeConstants.SPACE_SM }) {
            ForEach(this.favorites, (item: FavoriteRecipe) => {
              this.FavoriteCard(item)
            })
          }
          .padding({ left: ThemeConstants.SPACE_MD, right: ThemeConstants.SPACE_MD, bottom: 40 })
        }
        .layoutWeight(1)
        .scrollBar(BarState.Off)
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor(ThemeColors.BG_PRIMARY)
  }

  @Builder
  HeaderBar() {
    Row() {
      Image($r('app.media.Left'))
        .width(24)
        .height(24)
        .fillColor(ThemeColors.TEXT_PRIMARY)
        .onClick(() => Router.back())

      Blank()

      Text('æˆ‘çš„æ”¶è—')
        .fontSize(ThemeConstants.FONT_SIZE_LG)
        .fontWeight(FontWeight.Medium)
        .fontColor(ThemeColors.TEXT_PRIMARY)

      Blank()

      Row().width(24)
    }
    .width('100%')
    .height(56)
    .padding({ left: 16, right: 16, top: 40 })
  }

  @Builder
  EmptyState() {
    Column({ space: ThemeConstants.SPACE_MD }) {
      Text('ðŸ“¦')
        .fontSize(60)
      Text('æš‚æ— æ”¶è—')
        .fontSize(ThemeConstants.FONT_SIZE_MD)
        .fontColor(ThemeColors.TEXT_SECONDARY)
      Text('æµè§ˆé…æ–¹åº“ï¼Œæ”¶è—å–œæ¬¢çš„é…æ–¹')
        .fontSize(ThemeConstants.FONT_SIZE_SM)
        .fontColor(ThemeColors.TEXT_MUTED)
    }
    .width('100%')
    .layoutWeight(1)
    .justifyContent(FlexAlign.Center)
  }

  @Builder
  FavoriteCard(item: FavoriteRecipe) {
    Row({ space: ThemeConstants.SPACE_MD }) {
      // å·¦ä¾§å›¾æ ‡
      Column() {
        Text('ðŸŽ£')
          .fontSize(28)
      }
      .width(56)
      .height(56)
      .backgroundColor(ThemeColors.BG_TERTIARY)
      .borderRadius(ThemeConstants.RADIUS_SM)
      .justifyContent(FlexAlign.Center)

      // ä¸­é—´ä¿¡æ¯
      Column({ space: 4 }) {
        Text(item.name)
          .fontSize(ThemeConstants.FONT_SIZE_MD)
          .fontWeight(FontWeight.Medium)
          .fontColor(ThemeColors.TEXT_PRIMARY)

        Row({ space: ThemeConstants.SPACE_SM }) {
          Text(`ðŸŸ ${item.targetFish}`)
            .fontSize(ThemeConstants.FONT_SIZE_XS)
            .fontColor(ThemeColors.TEXT_SECONDARY)
          Text(`â­ ${item.rating}`)
            .fontSize(ThemeConstants.FONT_SIZE_XS)
            .fontColor(ThemeColors.PRIMARY)
        }

        Text(`å·²ä½¿ç”¨ ${item.usageCount} æ¬¡ Â· ${item.addTime}æ”¶è—`)
          .fontSize(ThemeConstants.FONT_SIZE_XS)
          .fontColor(ThemeColors.TEXT_MUTED)
      }
      .alignItems(HorizontalAlign.Start)
      .layoutWeight(1)

      // å³ä¾§ç®­å¤´
      Text('>')
        .fontSize(ThemeConstants.FONT_SIZE_MD)
        .fontColor(ThemeColors.TEXT_MUTED)
    }
    .width('100%')
    .padding(ThemeConstants.SPACE_MD)
    .backgroundColor(ThemeColors.BG_CARD)
    .borderRadius(ThemeConstants.RADIUS_MD)
    .onClick(() => {
      Router.push(AppConstants.ROUTE_RECIPE_DETAIL, { id: item.id });
    })
  }
}
