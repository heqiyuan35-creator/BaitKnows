import { MapComponent, mapCommon, map } from '@kit.MapKit';
import { AsyncCallback, BusinessError } from '@kit.BasicServicesKit';

@Entry
@Component
struct HuaweiMapDemo {
  private TAG = "HuaweiMapDemo";
  private mapOptions?: mapCommon.MapOptions;
  private callback?: AsyncCallback<map.MapComponentController>;
  private mapController?: map.MapComponentController;
  private mapEventManager?: map.MapEventManager;

  aboutToAppear(): void {
    // åœ°å›¾åˆå§‹åŒ–å‚æ•°ï¼Œè®¾ç½®åœ°å›¾ä¸­å¿ƒç‚¹åæ ‡åŠå±‚çº§
    this.mapOptions = {
      position: {
        target: {
          latitude: 39.9,
          longitude: 116.4
        },
        zoom: 10
      }
    };

    // åœ°å›¾åˆå§‹åŒ–çš„å›è°ƒ
    this.callback = async (err, mapController) => {
      if (!err) {
        // è·å–åœ°å›¾çš„æ§åˆ¶å™¨ç±»ï¼Œç”¨æ¥æ“ä½œåœ°å›¾
        this.mapController = mapController;
        this.mapEventManager = this.mapController.getEventManager();
        let callback = () => {
          console.info(this.TAG, `on-mapLoad`);
        }
        this.mapEventManager.on("mapLoad", callback);
      } else {
        console.error(`Failed to initialize the map, code isï¼?{err.code}, message is ${err.message}`);
      }
    };
  }

  // é¡µé¢æ¯æ¬¡æ˜¾ç¤ºæ—¶è§¦å‘ä¸€æ¬¡ï¼ŒåŒ…æ‹¬è·¯ç”±è¿‡ç¨‹ã€åº”ç”¨è¿›å…¥å‰å°ç­‰åœºæ™¯ï¼Œä»…@Entryè£…é¥°çš„è‡ªå®šä¹‰ç»„ä»¶ç”Ÿæ•ˆ
  onPageShow(): void {
    // å°†åœ°å›¾åˆ‡æ¢åˆ°å‰å°
    if (this.mapController) {
      this.mapController.show();
    }
  }

  // é¡µé¢æ¯æ¬¡éšè—æ—¶è§¦å‘ä¸€æ¬¡ï¼ŒåŒ…æ‹¬è·¯ç”±è¿‡ç¨‹ã€åº”ç”¨è¿›å…¥åå°ç­‰åœºæ™¯ï¼Œä»…@Entryè£…é¥°çš„è‡ªå®šä¹‰ç»„ä»¶ç”Ÿæ•ˆ
  onPageHide(): void {
    // å°†åœ°å›¾åˆ‡æ¢åˆ°åå°
    if (this.mapController) {
      this.mapController.hide();
    }
  }

  build() {
    Stack() {
      // è°ƒç”¨MapComponentç»„ä»¶åˆå§‹åŒ–åœ°å›?
      MapComponent({ mapOptions: this.mapOptions, mapCallback: this.callback }).width('100%').height('100%');
    }.height('100%')
  }
}