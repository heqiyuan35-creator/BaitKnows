/**
 * é¥µçŸ¥ï¿½?- é…æ–¹åº“é¡µï¿½?
 * æ°´åŸŸTabã€é±¼ç§ç­›é€‰ã€é…æ–¹åˆ—ï¿½?
 */
import { ThemeColors } from '../theme/ThemeColors';
import { ThemeConstants } from '../theme/ThemeConstants';
import { Router } from '../router/Router';
import { ALL_FISH_DATA, FishData, getFishByWaterType } from '../data/FishData';
import { userDataService, CustomRecipe } from '../services/UserDataService';

// æ°´åŸŸTabæ¥å£
interface WaterTab {
  type: string;
  label: string;
}

// é±¼ç§ç­›é€‰æ¥ï¿½?
interface FishFilter {
  id: string;
  name: string;
  icon: Resource;
}

// é…æ–¹å¡ç‰‡æ¥å£
interface RecipeCard {
  id: string;
  name: string;
  targetFish: string;
  waterType: string;  // æ°´åŸŸç±»å‹
  tags: string[];
  ingredients: string[];
  rating: number;
  catchRate: number;
  isBeginnerFriendly: boolean;
  isFavorite: boolean;
  isUserRecipe: boolean;  // æ˜¯å¦ä¸ºç”¨æˆ·é…ï¿½?
}

@Component
export struct RecipeBrowserPage {
  @State currentWaterTab: number = 0;
  @State selectedFishFilter: string = 'all';
  @State allRecipes: RecipeCard[] = [];  // æ‰€æœ‰é…ï¿½?
  @State recipes: RecipeCard[] = [];     // ç­›é€‰åçš„é…ï¿½?
  @State fishFilters: FishFilter[] = []; // åŠ¨æ€é±¼ç§ç­›ï¿½?

  // æ°´åŸŸTabï¼ˆå››å¤§ç±»ï¼šæ± å¡˜ã€æ²³æµã€æ°´åº“ã€æ¹–æ³Šï¼‰
  private waterTabs: WaterTab[] = [
    { type: 'pond', label: 'æ± å¡˜' },
    { type: 'river', label: 'æ²³æµ' },
    { type: 'reservoir', label: 'æ°´åº“' },
    { type: 'lake', label: 'æ¹–æ³Š' }
  ];

  aboutToAppear(): void {
    this.loadAllData();
  }

  // åŠ è½½æ‰€æœ‰æ•°ï¿½?
  private async loadAllData(): Promise<void> {
    await userDataService.load();
    this.loadRecipes();
    this.updateFishFilters();
  }

  // æ›´æ–°å½“å‰æ°´åŸŸå¯ç”¨çš„é±¼ç§ï¼ˆä½¿ç”¨ç»Ÿä¸€æ•°æ®æºï¼‰
  private updateFishFilters(): void {
    const waterType = this.waterTabs[this.currentWaterTab].type;

    // ä»ç»Ÿä¸€æ•°æ®æºè·å–è¯¥æ°´åŸŸçš„é±¼ï¿½?
    const fishList = getFishByWaterType(waterType);

    // æ„å»ºé±¼ç§ç­›é€‰åˆ—ï¿½?
    const filters: FishFilter[] = [{ id: 'all', name: 'å…¨éƒ¨', icon: $r('app.media.Fishs') }];

    fishList.forEach((fish: FishData) => {
      filters.push({
        id: fish.id,
        name: fish.name,
        icon: fish.icon
      });
    });

    this.fishFilters = filters;
  }

  // æ ¹æ®é±¼ç§IDè·å–ä¸­æ–‡ï¿½?
  private getFishName(fishId: string): string {
    const fish = ALL_FISH_DATA.find((f: FishData) => f.id === fishId);
    return fish ? fish.name : fishId;
  }

  private loadRecipes(): void {
    // å„æ°´åŸŸé…æ–¹æ•°ï¿½?- æ¯ä¸ªé…æ–¹éƒ½æœ‰ç‹¬ç‰¹çš„é…æ–™å’Œå±ï¿½?
    this.allRecipes = [
      // ==================== æ± å¡˜é…æ–¹ ====================
      // é²«é±¼
      { id: 'r_001', name: 'æ± å¡˜é²«é±¼æ•£ç‚®', targetFish: 'é²«é±¼', waterType: 'pond',
        tags: ['æ˜¥å­£', 'æµ…æ°´'], ingredients: ['éº¸çš®', 'é›ªèŠ±ï¿½?, 'æ‹‰ä¸ï¿½?],
        rating: 4.6, catchRate: 88, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // é²¤é±¼
      { id: 'r_002', name: 'é»‘å‘é²¤é±¼é¢—ç²’', targetFish: 'é²¤é±¼', waterType: 'pond',
        tags: ['å››å­£', 'é»‘å‘'], ingredients: ['åŸå¡˜é¢—ç²’', 'å°è¯', 'çŠ¶æ€ç²‰'],
        rating: 4.8, catchRate: 92, isBeginnerFriendly: false, isFavorite: true, isUserRecipe: false },
      // è‰é±¼
      { id: 'r_003', name: 'æ± å¡˜è‰é±¼é’è‰ï¿½?, targetFish: 'è‰é±¼', waterType: 'pond',
        tags: ['å¤å­£', 'æµ®é’“'], ingredients: ['å«©è‰', 'ç‰ç±³', 'éº¦éº¸'],
        rating: 4.5, catchRate: 85, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // é³™é±¼
      { id: 'r_004', name: 'æ± å¡˜é³™é±¼é…¸è‡­ï¿½?, targetFish: 'é³™é±¼', waterType: 'pond',
        tags: ['å¤å­£', 'æµ®é’“'], ingredients: ['è‡­è±†è…æ±', 'è’œç²‰', 'é›ªèŠ±ï¿½?],
        rating: 4.6, catchRate: 86, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // é²¢é±¼
      { id: 'r_005', name: 'æ± å¡˜é²¢é±¼é…¸é¥µ', targetFish: 'é²¢é±¼', waterType: 'pond',
        tags: ['å¤å­£', 'æµ®é’“'], ingredients: ['æœé…¸', 'ç™½é†‹', 'é›ªèŠ±ï¿½?],
        rating: 4.5, catchRate: 84, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // ç½—éï¿½?
      { id: 'r_006', name: 'å—æ–¹ç½—éä¸“ç”¨ï¿½?, targetFish: 'ç½—éï¿½?, waterType: 'pond',
        tags: ['å¤å­£', 'åº•é’“'], ingredients: ['ç½—éé¢—ç²’', 'è™¾ç²‰', 'èš¯èš“ï¿½?],
        rating: 4.4, catchRate: 82, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // æ–‘ç‚¹å‰å°¾ï¿½?
      { id: 'r_007', name: 'é»‘å‘å‰å°¾ä¸“ç”¨ï¿½?, targetFish: 'æ–‘ç‚¹å‰å°¾ï¿½?, waterType: 'pond',
        tags: ['å¤œé’“', 'åº•é’“'], ingredients: ['é²¶é±¼é¢—ç²’', 'é¸¡è‚ï¿½?, 'è™¾ç²‰'],
        rating: 4.5, catchRate: 85, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // é²¶é±¼
      { id: 'r_008', name: 'æ± å¡˜é²¶é±¼è…¥é¥µ', targetFish: 'é²¶é±¼', waterType: 'pond',
        tags: ['å¤œé’“', 'åº•é’“'], ingredients: ['é¸¡è‚', 'èš¯èš“', 'è¡€ï¿½?],
        rating: 4.6, catchRate: 88, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // æ³¥é³…
      { id: 'r_009', name: 'æ± å¡˜æ³¥é³…ï¿½?, targetFish: 'æ³¥é³…', waterType: 'pond',
        tags: ['å¤å­£', 'åº•é’“'], ingredients: ['èš¯èš“', 'çº¢è™«'],
        rating: 4.2, catchRate: 75, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // é»‘é±¼
      { id: 'r_010', name: 'æ± å¡˜é»‘é±¼é›·è›™', targetFish: 'é»‘é±¼', waterType: 'pond',
        tags: ['å¤å­£', 'è·¯äºš'], ingredients: ['é›·è›™', 'è½¯è™«', 'æ³¥é³…'],
        rating: 4.7, catchRate: 85, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // ç”²é±¼
      { id: 'r_011', name: 'æ± å¡˜ç”²é±¼ï¿½?, targetFish: 'ç”²é±¼', waterType: 'pond',
        tags: ['å¤œé’“', 'åº•é’“'], ingredients: ['é¸¡è‚', 'çŒªè‚', 'èš¯èš“'],
        rating: 4.4, catchRate: 78, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },

      // ==================== æ²³æµé…æ–¹ ====================
      // é²«é±¼
      { id: 'r_101', name: 'é‡æ²³é²«é±¼èš¯èš“ä¼´ä¾£', targetFish: 'é²«é±¼', waterType: 'river',
        tags: ['å››å­£', 'èµ°æ°´'], ingredients: ['èš¯èš“ï¿½?, 'çº¢è™«', 'é…’ç±³'],
        rating: 4.7, catchRate: 90, isBeginnerFriendly: true, isFavorite: true, isUserRecipe: false },
      // é²¤é±¼
      { id: 'r_102', name: 'æ±Ÿæ²³é²¤é±¼ç‰ç±³ï¿½?, targetFish: 'é²¤é±¼', waterType: 'river',
        tags: ['å¤ç§‹', 'æ·±æ°´'], ingredients: ['å‘é…µç‰ç±³', 'èœ‚èœœ', 'éº¦ç²’'],
        rating: 4.8, catchRate: 95, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // è‰é±¼
      { id: 'r_103', name: 'æ²³æµè‰é±¼å«©è‰ï¿½?, targetFish: 'è‰é±¼', waterType: 'river',
        tags: ['å¤å­£', 'æµ®é’“'], ingredients: ['å«©è‰', 'èŠ¦è‹‡ï¿½?, 'ç‰ç±³ï¿½?],
        rating: 4.6, catchRate: 85, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // é²¶é±¼
      { id: 'r_104', name: 'æ²³æµé²¶é±¼è…¥é¥µ', targetFish: 'é²¶é±¼', waterType: 'river',
        tags: ['å¤œé’“', 'æ·±æ½­'], ingredients: ['é¸¡è‚', 'èš¯èš“', 'æ³¥é³…'],
        rating: 4.6, catchRate: 88, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // é»„é¢¡ï¿½?
      { id: 'r_105', name: 'æ²³æµé»„é¢¡é±¼é¥µ', targetFish: 'é»„é¢¡ï¿½?, waterType: 'river',
        tags: ['å¤œé’“', 'çŸ³ç¼'], ingredients: ['èš¯èš“', 'é¸¡è‚', 'çº¢è™«'],
        rating: 4.5, catchRate: 85, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // é³Šé±¼
      { id: 'r_106', name: 'æ²³æµé³Šé±¼ç´ é¥µ', targetFish: 'é³Šé±¼', waterType: 'river',
        tags: ['æ˜¥å¤', 'ä¸­å±‚'], ingredients: ['éº¸çš®', 'ç‰ç±³ï¿½?, 'èœ‚èœœ'],
        rating: 4.5, catchRate: 82, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // ç¿˜å˜´
      { id: 'r_107', name: 'æ²³æµç¿˜å˜´è·¯äºšï¿½?, targetFish: 'ç¿˜å˜´', waterType: 'river',
        tags: ['å¤ç§‹', 'è·¯äºš'], ingredients: ['äº®ç‰‡', 'æ´»è™¾', 'å°é±¼'],
        rating: 4.7, catchRate: 82, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // é©¬å£
      { id: 'r_108', name: 'æºªæµé©¬å£ï¿½?, targetFish: 'é©¬å£', waterType: 'river',
        tags: ['å¤å­£', 'è·¯äºš'], ingredients: ['èš‚èš±', 'èŸ‹èŸ€', 'äº®ç‰‡'],
        rating: 4.6, catchRate: 80, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // é²ƒé±¼
      { id: 'r_109', name: 'æ€¥æµé²ƒé±¼ï¿½?, targetFish: 'é²ƒé±¼', waterType: 'river',
        tags: ['å¤å­£', 'æ€¥æµ'], ingredients: ['èš¯èš“', 'æ´»è™¾', 'èºè›³'],
        rating: 4.4, catchRate: 78, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // èµ¤çœ¼ï¿½?
      { id: 'r_110', name: 'æ²³é’“èµ¤çœ¼é³Ÿé¥µ', targetFish: 'èµ¤çœ¼ï¿½?, waterType: 'river',
        tags: ['æ˜¥å¤', 'ä¸­å±‚'], ingredients: ['èš¯èš“', 'ç‰ç±³ï¿½?, 'é¢ç²‰'],
        rating: 4.3, catchRate: 76, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // æ³¥é³…
      { id: 'r_111', name: 'æ²³æµæ³¥é³…ï¿½?, targetFish: 'æ³¥é³…', waterType: 'river',
        tags: ['å¤å­£', 'æ³¥åº•'], ingredients: ['èš¯èš“', 'çº¢è™«'],
        rating: 4.2, catchRate: 72, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // æ²³é³œ
      { id: 'r_112', name: 'æ²³æµé³œé±¼æ´»é¥µ', targetFish: 'æ²³é³œ', waterType: 'river',
        tags: ['æ˜¥ç§‹', 'æ´»é¥µ'], ingredients: ['æ´»æ³¥ï¿½?, 'æ´»è™¾', 'å°é±¼'],
        rating: 4.7, catchRate: 85, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },

      // ==================== æ°´åº“é…æ–¹ ====================
      // é²¤é±¼
      { id: 'r_201', name: 'æ°´åº“å¤§é²¤å®ˆé’“ï¿½?, targetFish: 'é²¤é±¼', waterType: 'reservoir',
        tags: ['ç§‹å­£', 'å®ˆå¤§ï¿½?], ingredients: ['å‘é…µç‰ç±³', 'çº¢è–¯', 'è¯é…’'],
        rating: 4.9, catchRate: 98, isBeginnerFriendly: false, isFavorite: true, isUserRecipe: false },
      // è‰é±¼
      { id: 'r_202', name: 'æ°´åº“è‰é±¼æµ®é’“ï¿½?, targetFish: 'è‰é±¼', waterType: 'reservoir',
        tags: ['å¤å­£', 'æµ®é’“'], ingredients: ['å«©ç‰ï¿½?, 'é’è‰', 'éº¦éº¸'],
        rating: 4.7, catchRate: 90, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // é³™é±¼
      { id: 'r_203', name: 'æ°´åº“é³™é±¼æµ®é’“ï¿½?, targetFish: 'é³™é±¼', waterType: 'reservoir',
        tags: ['å¤å­£', 'æµ®é’“'], ingredients: ['è—¿é¦™æ­£æ°”ï¿½?, 'è‡­è±†è…æ±', 'è½»éº¸'],
        rating: 4.6, catchRate: 88, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // é²¢é±¼
      { id: 'r_204', name: 'æ°´åº“é²¢é±¼æ‰‹ç«¿ï¿½?, targetFish: 'é²¢é±¼', waterType: 'reservoir',
        tags: ['å¤å­£', 'æµ®é’“'], ingredients: ['æœé…¸', 'ç™½é†‹', 'é›ªèŠ±ï¿½?],
        rating: 4.5, catchRate: 85, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // é’é±¼
      { id: 'r_205', name: 'æ°´åº“é’é±¼èºè›³ï¿½?, targetFish: 'é’é±¼', waterType: 'reservoir',
        tags: ['å››å­£', 'åº•é’“'], ingredients: ['ç”°èº', 'èºè›³ï¿½?, 'èšŒè‚‰ï¿½?],
        rating: 4.8, catchRate: 92, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // é³œé±¼
      { id: 'r_206', name: 'æ°´åº“é³œé±¼æ´»é¥µ', targetFish: 'é³œé±¼', waterType: 'reservoir',
        tags: ['æ˜¥ç§‹', 'æ´»é¥µ'], ingredients: ['æ´»æ³¥ï¿½?, 'æ´»è™¾', 'å°é±¼'],
        rating: 4.9, catchRate: 95, isBeginnerFriendly: false, isFavorite: true, isUserRecipe: false },
      // æ­¦æ˜Œï¿½?
      { id: 'r_207', name: 'æ°´åº“æ­¦æ˜Œé±¼ç´ ï¿½?, targetFish: 'æ­¦æ˜Œï¿½?, waterType: 'reservoir',
        tags: ['æ˜¥å¤', 'ä¸­å±‚'], ingredients: ['éº¸çš®', 'ç‰ç±³ï¿½?, 'èœ‚èœœ'],
        rating: 4.5, catchRate: 82, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // å·¨é²¤
      { id: 'r_208', name: 'æ°´åº“å·¨é²¤é‡çªï¿½?, targetFish: 'å·¨é²¤', waterType: 'reservoir',
        tags: ['æ˜¥ç§‹', 'å®ˆå¤§ï¿½?], ingredients: ['å‘é…µç‰ç±³', 'çº¢è–¯', 'è¯é…’'],
        rating: 4.8, catchRate: 90, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // é»„å°¾ï¿½?
      { id: 'r_209', name: 'æ°´åº“é»„å°¾é²´é¥µ', targetFish: 'é»„å°¾ï¿½?, waterType: 'reservoir',
        tags: ['æ˜¥å¤', 'åº•é’“'], ingredients: ['æ··åˆé¢—ç²’', 'éº¸çš®', 'èš¯èš“ï¿½?],
        rating: 4.4, catchRate: 78, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // é²®é±¼
      { id: 'r_210', name: 'å—æ–¹é²®é±¼ä¸“ç”¨ï¿½?, targetFish: 'é²®é±¼', waterType: 'reservoir',
        tags: ['å¤ç§‹', 'åº•é’“'], ingredients: ['èŠ±ç”Ÿï¿½?, 'éº¸çš®', 'ç‰ç±³ï¿½?],
        rating: 4.6, catchRate: 85, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // å¤§å£é»‘é²ˆ
      { id: 'r_211', name: 'æ°´åº“é»‘é²ˆè·¯äºšï¿½?, targetFish: 'å¤§å£é»‘é²ˆ', waterType: 'reservoir',
        tags: ['æ˜¥å¤ï¿½?, 'è·¯äºš'], ingredients: ['è½¯è™«', 'æ´»è™¾', 'å°é±¼'],
        rating: 4.8, catchRate: 88, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // ç¿˜å˜´
      { id: 'r_212', name: 'æ°´åº“ç¿˜å˜´è·¯äºšï¿½?, targetFish: 'ç¿˜å˜´', waterType: 'reservoir',
        tags: ['å¤ç§‹', 'è·¯äºš'], ingredients: ['äº®ç‰‡', 'æ´»è™¾', 'å°é±¼'],
        rating: 4.7, catchRate: 85, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },

      // ==================== æ¹–æ³Šé…æ–¹ ====================
      // é²«é±¼
      { id: 'r_301', name: 'æ¹–æ³Šé²«é±¼ä¼ ç»Ÿï¿½?, targetFish: 'é²«é±¼', waterType: 'lake',
        tags: ['å››å­£', 'ä¼ ç»Ÿï¿½?], ingredients: ['é…’ç±³', 'èš¯èš“', 'çº¢è™«'],
        rating: 4.7, catchRate: 90, isBeginnerFriendly: true, isFavorite: true, isUserRecipe: false },
      // é²¤é±¼
      { id: 'r_302', name: 'æ¹–æ³Šé²¤é±¼çˆ†ç‚¸ï¿½?, targetFish: 'é²¤é±¼', waterType: 'lake',
        tags: ['å¤ç§‹', 'æµ·ç«¿'], ingredients: ['ç³ é¥¼', 'ç‰ç±³', 'éº¦ç²’'],
        rating: 4.8, catchRate: 92, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // è‰é±¼
      { id: 'r_303', name: 'æ¹–æ³Šè‰é±¼æµ®é’“ï¿½?, targetFish: 'è‰é±¼', waterType: 'lake',
        tags: ['å¤å­£', 'æµ®é’“'], ingredients: ['å«©è‰', 'èŠ¦è‹‡ï¿½?, 'ç‰ç±³ï¿½?],
        rating: 4.6, catchRate: 85, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // é³œé±¼
      { id: 'r_304', name: 'æ¹–æ³Šé³œé±¼æ´»é¥µ', targetFish: 'é³œé±¼', waterType: 'lake',
        tags: ['å¤ç§‹', 'æ´»é¥µ'], ingredients: ['æ´»æ³¥ï¿½?, 'æ´»è™¾', 'å°é±¼'],
        rating: 4.9, catchRate: 95, isBeginnerFriendly: false, isFavorite: true, isUserRecipe: false },
      // é’é±¼
      { id: 'r_305', name: 'æ¹–æ³Šé’é±¼èºè›³ï¿½?, targetFish: 'é’é±¼', waterType: 'lake',
        tags: ['å¤ç§‹', 'åº•é’“'], ingredients: ['ç”°èº', 'èºè›³ï¿½?, 'èšŒè‚‰'],
        rating: 4.8, catchRate: 90, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // é»‘é±¼
      { id: 'r_306', name: 'æ¹–æ³Šé»‘é±¼é›·è›™', targetFish: 'é»‘é±¼', waterType: 'lake',
        tags: ['å¤å­£', 'è·¯äºš'], ingredients: ['é›·è›™', 'è½¯è™«', 'æ³¥é³…'],
        rating: 4.7, catchRate: 85, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // ç‹—é±¼
      { id: 'r_307', name: 'åŒ—æ–¹ç‹—é±¼ï¿½?, targetFish: 'ç‹—é±¼', waterType: 'lake',
        tags: ['æ˜¥ç§‹ï¿½?, 'è·¯äºš'], ingredients: ['å¤§å‹è½¯è™«', 'å°é±¼', 'äº®ç‰‡'],
        rating: 4.6, catchRate: 80, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // é²ˆé±¼
      { id: 'r_308', name: 'æ¹–é’“é²ˆé±¼ï¿½?, targetFish: 'é²ˆé±¼', waterType: 'lake',
        tags: ['æ˜¥ç§‹', 'æ´»é¥µ'], ingredients: ['æ´»è™¾', 'å°é±¼', 'èš¯èš“'],
        rating: 4.5, catchRate: 82, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // é“¶é±¼
      { id: 'r_309', name: 'é“¶é±¼ä¸“ç”¨ï¿½?, targetFish: 'é“¶é±¼', waterType: 'lake',
        tags: ['æ˜¥ç§‹', 'ç»†çº¿'], ingredients: ['çº¢è™«', 'å°è™«'],
        rating: 4.2, catchRate: 70, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // çº¢é³ï¿½?
      { id: 'r_310', name: 'çº¢é³é²Œè·¯äºšé¥µ', targetFish: 'çº¢é³ï¿½?, waterType: 'lake',
        tags: ['å¤ç§‹', 'è·¯äºš'], ingredients: ['äº®ç‰‡', 'æ´»è™¾', 'å°é±¼'],
        rating: 4.5, catchRate: 80, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // ç”²é±¼
      { id: 'r_311', name: 'æ¹–æ³Šç”²é±¼ï¿½?, targetFish: 'ç”²é±¼', waterType: 'lake',
        tags: ['å¤œé’“', 'åº•é’“'], ingredients: ['é¸¡è‚', 'çŒªè‚', 'èš¯èš“'],
        rating: 4.4, catchRate: 75, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // é»„é³
      { id: 'r_312', name: 'æ¹–æ³Šé»„é³ï¿½?, targetFish: 'é»„é³', waterType: 'lake',
        tags: ['å¤œé’“', 'æ´ç©´'], ingredients: ['èš¯èš“', 'å°é±¼'],
        rating: 4.3, catchRate: 72, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // æ²³èŸ¹
      { id: 'r_313', name: 'ç§‹å­£æ²³èŸ¹ï¿½?, targetFish: 'æ²³èŸ¹', waterType: 'lake',
        tags: ['ç§‹å­£', 'èŸ¹ç¬¼'], ingredients: ['é¸¡è‚', 'é±¼è‚‰', 'ç‰ç±³'],
        rating: 4.5, catchRate: 85, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // æ²³è™¾
      { id: 'r_314', name: 'æ¹–æ³Šæ²³è™¾ï¿½?, targetFish: 'æ²³è™¾', waterType: 'lake',
        tags: ['å¤ç§‹', 'è™¾ç¬¼'], ingredients: ['èš¯èš“', 'çº¢è™«', 'é¢ç²‰'],
        rating: 4.2, catchRate: 75, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // é³Šé±¼
      { id: 'r_315', name: 'æ¹–æ³Šé³Šé±¼ç´ é¥µ', targetFish: 'é³Šé±¼', waterType: 'lake',
        tags: ['æ˜¥å¤', 'æµ®é’“'], ingredients: ['éº¸çš®', 'ç‰ç±³ï¿½?, 'æ‹‰ä¸ï¿½?],
        rating: 4.5, catchRate: 82, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // æ­¦æ˜Œï¿½?
      { id: 'r_318', name: 'æ¹–æ³Šæ­¦æ˜Œé±¼ç´ ï¿½?, targetFish: 'æ­¦æ˜Œï¿½?, waterType: 'lake',
        tags: ['æ˜¥å¤', 'ä¸­å±‚'], ingredients: ['éº¸çš®', 'ç‰ç±³ï¿½?, 'èœ‚èœœ'],
        rating: 4.5, catchRate: 82, isBeginnerFriendly: true, isFavorite: false, isUserRecipe: false },
      // å¤§å£é»‘é²ˆ
      { id: 'r_316', name: 'æ¹–æ³Šé»‘é²ˆè·¯äºšï¿½?, targetFish: 'å¤§å£é»‘é²ˆ', waterType: 'lake',
        tags: ['æ˜¥å¤ï¿½?, 'è·¯äºš'], ingredients: ['è½¯è™«', 'æ´»è™¾', 'å°é±¼'],
        rating: 4.8, catchRate: 88, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false },
      // ç¿˜å˜´
      { id: 'r_317', name: 'æ¹–æ³Šç¿˜å˜´è·¯äºšï¿½?, targetFish: 'ç¿˜å˜´', waterType: 'lake',
        tags: ['å¤ç§‹', 'è·¯äºš'], ingredients: ['äº®ç‰‡', 'æ´»è™¾', 'å°é±¼'],
        rating: 4.7, catchRate: 85, isBeginnerFriendly: false, isFavorite: false, isUserRecipe: false }
    ];

    // åŠ è½½ç”¨æˆ·ä¿å­˜çš„é…æ–¹
    this.loadUserRecipes();

    this.filterRecipes();
  }

  // åŠ è½½ç”¨æˆ·ä¿å­˜çš„é…æ–¹
  private loadUserRecipes(): void {
    const userRecipes = userDataService.getCustomRecipes();

    for (let i = 0; i < userRecipes.length; i++) {
      const ur = userRecipes[i];

      // è½¬æ¢æ°´åŸŸç±»å‹
      let waterType = 'pond';
      if (ur.waterType === 'river' || ur.waterType === 'wild_pond') {
        waterType = 'river';
      } else if (ur.waterType === 'reservoir') {
        waterType = 'reservoir';
      } else if (ur.waterType === 'pond') {
        waterType = 'pond';
      }

      // è·å–é±¼ç§åç§°
      let targetFishName = 'é²«é±¼';
      if (ur.targetFish.length > 0) {
        targetFishName = this.getFishName(ur.targetFish[0]);
      }

      // è·å–å­£èŠ‚æ ‡ç­¾
      let seasonTag = 'å››å­£';
      if (ur.season === 'spring') seasonTag = 'æ˜¥å­£';
      else if (ur.season === 'summer') seasonTag = 'å¤å­£';
      else if (ur.season === 'autumn') seasonTag = 'ç§‹å­£';
      else if (ur.season === 'winter') seasonTag = 'å†¬å­£';

      // è·å–é…æ–™åç§°åˆ—è¡¨
      const ingredientNames: string[] = [];
      for (let j = 0; j < Math.min(3, ur.ingredients.length); j++) {
        ingredientNames.push(ur.ingredients[j].name);
      }

      const card: RecipeCard = {
        id: ur.id,
        name: ur.name,
        targetFish: targetFishName,
        waterType: waterType,
        tags: [seasonTag, 'è‡ªå®šä¹‰'],
        ingredients: ingredientNames,
        rating: 4.5,
        catchRate: 80,
        isBeginnerFriendly: false,
        isFavorite: true,
        isUserRecipe: true
      };

      this.allRecipes.unshift(card);  // ç”¨æˆ·é…æ–¹æ”¾åœ¨æœ€å‰é¢
    }
  }

  // ç­›é€‰é…æ–¹
  private filterRecipes(): void {
    const waterType = this.waterTabs[this.currentWaterTab].type;
    const fishFilter = this.selectedFishFilter;

    this.recipes = this.allRecipes.filter((recipe: RecipeCard) => {
      // æ°´åŸŸç­›ï¿½?
      if (recipe.waterType !== waterType) return false;
      // é±¼ç§ç­›ï¿½?
      if (fishFilter !== 'all') {
        const targetFishName = this.getFishName(fishFilter);
        if (!recipe.targetFish.includes(targetFishName)) return false;
      }
      return true;
    });
  }

  build() {
    Column() {
      // é¡¶éƒ¨æ ‡é¢˜ï¿½?
      this.HeaderBar()

      // æ°´åŸŸTab
      this.WaterTabBar()

      // å†…å®¹åŒºåŸŸ
      Row() {
        // å·¦ä¾§é±¼ç§ç­›ï¿½?
        this.FishFilterSidebar()

        // å³ä¾§é…æ–¹åˆ—è¡¨
        this.RecipeList()
      }
      .width('100%')
      .layoutWeight(1)
      .alignItems(VerticalAlign.Top)  // é¡¶éƒ¨å¯¹é½
    }
    .width('100%')
    .height('100%')
    .backgroundColor(ThemeColors.BG_PRIMARY)
  }

  @Builder
  HeaderBar() {
    Row() {
      Text('é±¼é¥µé…æ–¹ï¿½?)
        .fontSize(ThemeConstants.FONT_SIZE_XL)
        .fontWeight(FontWeight.Bold)
        .fontColor(ThemeColors.TEXT_PRIMARY)
    }
    .width('100%')
    .height(56)
    .padding({ left: 16, right: 16 })
    .margin({ top: 44 })
    .justifyContent(FlexAlign.Center)
  }

  @Builder
  WaterTabBar() {
    Row() {
      ForEach(this.waterTabs, (tab: WaterTab, index: number) => {
        Column() {
          Text(tab.label)
            .fontSize(ThemeConstants.FONT_SIZE_BASE)
            .fontColor(this.currentWaterTab === index ? ThemeColors.PRIMARY : ThemeColors.TEXT_SECONDARY)
            .fontWeight(this.currentWaterTab === index ? FontWeight.Medium : FontWeight.Normal)
            .padding({ left: 16, right: 16, top: 12, bottom: 8 })

          // é€‰ä¸­æŒ‡ç¤ºï¿½?
          Row()
            .width(24)
            .height(3)
            .backgroundColor(this.currentWaterTab === index ? ThemeColors.PRIMARY : Color.Transparent)
            .borderRadius(2)
        }
        .onClick(() => {
          this.currentWaterTab = index;
          this.selectedFishFilter = 'all';  // åˆ‡æ¢æ°´åŸŸæ—¶é‡ç½®é±¼ç§ç­›ï¿½?
          this.updateFishFilters();  // æ›´æ–°å¯ç”¨é±¼ç§
          this.filterRecipes();
        })
      })
    }
    .width('100%')
    .padding({ bottom: 4 })
    .backgroundColor(ThemeColors.BG_SECONDARY)
  }

  @Builder
  FishFilterSidebar() {
    Scroll() {
      Column({ space: 4 }) {
        ForEach(this.fishFilters, (filter: FishFilter) => {
          this.FishFilterItem(filter)
        })
      }
      .padding({ top: 8, bottom: 8 })
    }
    .width(72)
    .height('100%')
    .backgroundColor(ThemeColors.BG_SECONDARY)
    .scrollBar(BarState.Off)
  }

  @Builder
  FishFilterItem(filter: FishFilter) {
    Column({ space: 4 }) {
      Row() {
        Image(filter.icon)
          .width(28)
          .height(28)
          .objectFit(ImageFit.Contain)
      }
      .width(44)
      .height(44)
      .backgroundColor(this.selectedFishFilter === filter.id ? 'rgba(232, 168, 73, 0.15)' : ThemeColors.BG_TERTIARY)
      .borderRadius(12)
      .justifyContent(FlexAlign.Center)
      .border({
        width: this.selectedFishFilter === filter.id ? 2 : 0,
        color: ThemeColors.PRIMARY
      })

      Text(filter.name)
        .fontSize(ThemeConstants.FONT_SIZE_XS)
        .fontColor(this.selectedFishFilter === filter.id ? ThemeColors.PRIMARY : ThemeColors.TEXT_SECONDARY)
        .fontWeight(this.selectedFishFilter === filter.id ? FontWeight.Medium : FontWeight.Normal)
    }
    .width('100%')
    .padding({ top: 10, bottom: 10 })
    .onClick(() => {
      this.selectedFishFilter = filter.id;
      this.filterRecipes();
    })
  }

  @Builder
  RecipeList() {
    Scroll() {
      Column({ space: ThemeConstants.SPACE_MD }) {
        // çƒ­é—¨æ¨èæ ‡é¢˜
        Row() {
          Text('çƒ­é—¨æ¨è')
            .fontSize(ThemeConstants.FONT_SIZE_MD)
            .fontWeight(FontWeight.Medium)
            .fontColor(ThemeColors.TEXT_PRIMARY)
          Blank()
          Text(`ï¿½?${this.recipes.length} ä¸ªé…æ–¹`)
            .fontSize(ThemeConstants.FONT_SIZE_SM)
            .fontColor(ThemeColors.TEXT_MUTED)
        }
        .width('100%')

        // é…æ–¹å¡ç‰‡åˆ—è¡¨
        ForEach(this.recipes, (recipe: RecipeCard) => {
          this.RecipeCardBuilder(recipe)
        })
      }
      .padding(ThemeConstants.SPACE_MD)
    }
    .layoutWeight(1)
    .height('100%')
    .scrollBar(BarState.Off)
  }

  @Builder
  RecipeCardBuilder(recipe: RecipeCard) {
    Column({ space: ThemeConstants.SPACE_SM }) {
      // ç”¨æˆ·é…æ–¹æ ‡è¯†
      if (recipe.isUserRecipe) {
        Row({ space: 4 }) {
          Text('â­')
            .fontSize(12)
          Text('æˆ‘çš„é…æ–¹')
            .fontSize(ThemeConstants.FONT_SIZE_XS)
            .fontColor(ThemeColors.PRIMARY)
        }
        .padding({ left: 8, right: 8, top: 4, bottom: 4 })
        .backgroundColor('rgba(232, 168, 73, 0.15)')
        .borderRadius(ThemeConstants.RADIUS_XS)
      }
      // ä¸Šé±¼ç‡æ ‡ç­¾
      else if (recipe.catchRate >= 90) {
        Row({ space: 4 }) {
          Text('ğŸ”¥')
            .fontSize(12)
          Text(`${recipe.catchRate}% ä¸Šé±¼ç‡`)
            .fontSize(ThemeConstants.FONT_SIZE_XS)
            .fontColor(ThemeColors.SUCCESS)
        }
        .padding({ left: 8, right: 8, top: 4, bottom: 4 })
        .backgroundColor('rgba(76, 175, 80, 0.15)')
        .borderRadius(ThemeConstants.RADIUS_XS)
      }

      // é…æ–¹åç§°å’Œæ”¶ï¿½?
      Row() {
        Text(recipe.name)
          .fontSize(ThemeConstants.FONT_SIZE_MD)
          .fontWeight(FontWeight.Medium)
          .fontColor(ThemeColors.TEXT_PRIMARY)
        Blank()
        Image(recipe.isFavorite ? $r('app.media.heartfill') : $r('app.media.heartfill'))
          .width(20)
          .height(20)
          .fillColor(recipe.isFavorite ? ThemeColors.PRIMARY : ThemeColors.TEXT_MUTED)
      }
      .width('100%')

      // æ ‡ç­¾
      Row({ space: 6 }) {
        ForEach(recipe.tags, (tag: string) => {
          Text(tag)
            .fontSize(ThemeConstants.FONT_SIZE_XS)
            .fontColor(ThemeColors.TEXT_SECONDARY)
            .padding({ left: 8, right: 8, top: 4, bottom: 4 })
            .backgroundColor(ThemeColors.BG_TERTIARY)
            .borderRadius(ThemeConstants.RADIUS_XS)
        })
      }

      // é…æ–™
      Row({ space: 6 }) {
        ForEach(recipe.ingredients, (ing: string) => {
          Row({ space: 4 }) {
            Circle()
              .width(6)
              .height(6)
              .fill(ThemeColors.PRIMARY)
            Text(ing)
              .fontSize(ThemeConstants.FONT_SIZE_SM)
              .fontColor(ThemeColors.TEXT_PRIMARY)
          }
        })
      }

      // æ–°æ‰‹å‹å¥½æ ‡ç­¾
      if (recipe.isBeginnerFriendly) {
        Row({ space: 4 }) {
          Text('ğŸ‘')
            .fontSize(10)
          Text('æ–°æ‰‹å‹å¥½')
            .fontSize(ThemeConstants.FONT_SIZE_XS)
            .fontColor(ThemeColors.INFO)
        }
        .padding({ left: 8, right: 8, top: 4, bottom: 4 })
        .backgroundColor('rgba(33, 150, 243, 0.15)')
        .borderRadius(ThemeConstants.RADIUS_XS)
      }

      // æŸ¥çœ‹è¯¦æƒ…æŒ‰é’®
      Button('æŸ¥çœ‹è¯¦æƒ… ï¿½?)
        .width('100%')
        .height(ThemeConstants.HEIGHT_BASE)
        .fontSize(ThemeConstants.FONT_SIZE_SM)
        .fontColor(ThemeColors.TEXT_PRIMARY)
        .backgroundColor(ThemeColors.PRIMARY)
        .borderRadius(ThemeConstants.RADIUS_SM)
        .margin({ top: 8 })
        .onClick(() => {
          Router.goToRecipeDetail(recipe.id);
        })
    }
    .width('100%')
    .padding(ThemeConstants.SPACE_MD)
    .backgroundColor(ThemeColors.BG_CARD)
    .borderRadius(ThemeConstants.RADIUS_MD)
  }
}
